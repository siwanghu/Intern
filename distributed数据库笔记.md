# 分布式数据库笔记（siwang.hu&nbsp;&nbsp;V1.0）  
> # 分布式一致性算法  
> + 分布式系统：运行在多台不同的网络计算机上的软硬件系统，并且仅通过消息传递来进行通信和协调  
>  
> + 分布式一致性问题：相互独立的节点之间如何就一项决议（事务）达成一致的问题  
> ## **1.&nbsp;&nbsp;2PC**  
> 2PC（二阶段提交协议），将事务的提交过程分为两个阶段来进行处理：准备阶段和提交阶段。事务的发起者称协调者，事务的执行者称参与者  
> **准备阶段**  
> + 协调者向所有参与者发送事务内容，询问是否可以提交事务，并等待所有参与者答复  
> + 各参与者执行事务操作，将Undo和Redo信息记入事务日志中（但不提交事务）  
> + 如参与者执行成功，给协调者反馈YES，即可以提交；如执行失败，给协调者反馈NO，即不可提交  
>  
> **提交阶段**  
> *此阶段分两种情况：所有参与者均反馈YES、或任何一个参与者反馈NO。所有参与者均反馈YES时，即提交事务。任何一个参与者反馈NO时，即中断事务*  
> **所有参与者均反馈YES**  
> + 协调者向所有参与者发出正式提交事务的请求（即Commit请求）  
> + 参与者执行Commit请求，并释放整个事务期间占用的资源  
> + 各参与者向协调者反馈Ack完成的消息  
> + 协调者收到所有参与者反馈的Ack消息后，即完成事务提交  
>  
> **任何一个参与者反馈NO**  
> + 协调者向所有参与者发出回滚请求（即Rollback请求）  
> + 参与者使用阶段1中的Undo信息执行回滚操作，并释放整个事务期间占用的资源  
> + 各参与者向协调者反馈Ack完成的消息  
> 协调者收到所有参与者反馈的Ack消息后，即完成事务中断  
>  
> **2PC的缺陷**  
> + 同步阻塞：最大的问题即同步阻塞，即：所有参与事务的逻辑均处于阻塞状态  
> + 单点：协调者存在单点问题，如果协调者出现故障，参与者将一直处于锁定状态  
> + 脑裂：在阶段2中，如果只有部分参与者接收并执行了Commit请求，会导致节点数据不一致
